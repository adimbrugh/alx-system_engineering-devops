#!/usr/bin/env python3
import os
import sys

def custom_to_decimal(value, base_chars):
    # Map characters exactly as they appear, no sorting
    char_to_val = {char: idx for idx, char in enumerate(base_chars)}
    base = len(base_chars)
    num = 0
    for char in value:
        if char not in char_to_val:
            print(f"Error: Invalid character '{char}' for base '{base_chars}'", file=sys.stderr)
            sys.exit(1)
        num = num * base + char_to_val[char]
    return num

def decimal_to_custom(num, base_chars):
    base = len(base_chars)
    if num == 0:
        return base_chars[0]
    result = ""
    while num > 0:
        result = base_chars[num % base] + result
        num //= base
    return result

def main():
    water_str = os.getenv("WATER")
    stir_str = os.getenv("STIR")

    if not water_str or not stir_str:
        print("Error: WATER and STIR environment variables must be set.", file=sys.stderr)
        sys.exit(1)

    water_base = "waetr"    # base 5, exact order
    stir_base = "tir."       # base 3, exact order
    result_base = "bestchol"  # base 8, exact order

    # Convert WATER and STIR to decimal
    water_dec = custom_to_decimal(water_str, water_base)
    stir_dec = custom_to_decimal(stir_str, stir_base)

    # Sum
    total = water_dec + stir_dec

    # Convert back to result base and print
    print(decimal_to_custom(total, result_base))

if __name__ == "__main__":
    main()
